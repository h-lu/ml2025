import streamlit as st
import numpy as np
import matplotlib.pyplot as plt
from sklearn.datasets import make_moons, make_circles
from sklearn.cluster import KMeans
from utils.font_manager import set_chinese_font

st.set_page_config(
    page_title="K-Meanså›é¡¾",
    page_icon="ğŸ”„",
    layout="wide"
)

st.title("K-Meansç®—æ³•å›é¡¾ä¸å±€é™æ€§")

st.markdown("""
æˆ‘ä»¬åœ¨ä¹‹å‰çš„è¯¾ç¨‹ä¸­å·²ç»å­¦ä¹ äº†K-Meansç®—æ³•ï¼Œå®ƒæ˜¯ä¸€ç§éå¸¸å¸¸ç”¨ä¸”é«˜æ•ˆçš„åˆ’åˆ†å¼èšç±»ç®—æ³•ã€‚

### æ ¸å¿ƒæ€æƒ³

å°†æ•°æ®ç‚¹åˆ’åˆ†ä¸ºé¢„å…ˆè®¾å®šçš„ K ä¸ªç°‡ï¼Œä½¿å¾—æ¯ä¸ªç‚¹éƒ½å±äºç¦»å…¶æœ€è¿‘çš„ç°‡ä¸­å¿ƒï¼ˆè´¨å¿ƒï¼‰ï¼Œå¹¶ä¸”ç°‡å†…æ•°æ®ç‚¹çš„å¹³æ–¹å’Œæœ€å°ã€‚

### ç®—æ³•æ­¥éª¤

1. éšæœºé€‰æ‹©Kä¸ªç‚¹ä½œä¸ºåˆå§‹ç°‡ä¸­å¿ƒ
2. å°†æ¯ä¸ªæ•°æ®ç‚¹åˆ†é…åˆ°æœ€è¿‘çš„ç°‡ä¸­å¿ƒ
3. é‡æ–°è®¡ç®—æ¯ä¸ªç°‡çš„ä¸­å¿ƒï¼ˆå‡å€¼ï¼‰
4. é‡å¤æ­¥éª¤2å’Œ3ï¼Œç›´åˆ°ç°‡ä¸­å¿ƒåŸºæœ¬ä¸å†å˜åŒ–æˆ–è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°

### ä¼˜ç‚¹
""")

# åˆ›å»ºä¸‰åˆ—å¸ƒå±€
col1, col2 = st.columns(2)

with col1:
    st.subheader("ä¼˜ç‚¹")
    st.markdown("""
    * **ç®€å•é«˜æ•ˆ**ï¼šç®—æ³•ç®€å•ï¼Œæ˜“äºç†è§£å’Œå®ç°
    * **è®¡ç®—é€Ÿåº¦å¿«**ï¼šé€‚åˆå¤„ç†å¤§è§„æ¨¡æ•°æ®é›†
    * **é€‚åˆå‘ç°çƒçŠ¶ç°‡**ï¼šå½“ç°‡å‘ˆçƒå½¢ä¸”åˆ†ç¦»æ˜æ˜¾æ—¶æ•ˆæœè¾ƒå¥½
    """)

with col2:
    st.subheader("ç¼ºç‚¹ä¸å±€é™æ€§")
    st.markdown("""
    * **éœ€è¦é¢„å…ˆæŒ‡å®šKå€¼**ï¼šKå€¼çš„é€‰æ‹©å¯¹ç»“æœå½±å“å¾ˆå¤§ï¼Œé€‰æ‹©ä¸å½“ä¼šå¯¼è‡´æ¬¡ä¼˜çš„èšç±»æ•ˆæœ
    * **å¯¹åˆå§‹è´¨å¿ƒæ•æ„Ÿ**ï¼šä¸åŒçš„åˆå§‹è´¨å¿ƒå¯èƒ½å¯¼è‡´ä¸åŒçš„èšç±»ç»“æœ
    * **å¯¹éçƒçŠ¶ç°‡æ•ˆæœä¸ä½³**ï¼šéš¾ä»¥å‘ç°éè§„åˆ™å½¢çŠ¶çš„ç°‡
    * **å¯¹å¼‚å¸¸å€¼æ•æ„Ÿ**ï¼šå¼‚å¸¸å€¼ä¼šå¯¹è´¨å¿ƒçš„è®¡ç®—äº§ç”Ÿè¾ƒå¤§å½±å“
    """)

st.markdown("---")

st.subheader("ç¼“è§£K-Meanså±€é™æ€§çš„æ–¹æ³•")
st.markdown("""
* **é€‰æ‹©Kå€¼**ï¼šä½¿ç”¨è‚˜éƒ¨æ³•åˆ™ã€è½®å»“ç³»æ•°ç­‰æ–¹æ³•è¾…åŠ©é€‰æ‹©Kå€¼
* **åˆå§‹åŒ–é—®é¢˜**ï¼šä½¿ç”¨K-Means++è¿›è¡Œåˆå§‹åŒ–ï¼Œæˆ–å¤šæ¬¡è¿è¡Œé€‰æ‹©æœ€ä½³ç»“æœï¼ˆscikit-learnä¸­çš„`n_init`å‚æ•°ï¼‰
* **éçƒçŠ¶ç°‡**ï¼šè€ƒè™‘ä½¿ç”¨å…¶ä»–èšç±»ç®—æ³•ï¼Œå¦‚å±‚æ¬¡èšç±»ã€DBSCANç­‰
* **å¼‚å¸¸å€¼**ï¼šé¢„å¤„ç†é˜¶æ®µè¿›è¡Œå¼‚å¸¸å€¼æ£€æµ‹å’Œå¤„ç†

æ­£æ˜¯å› ä¸ºK-Meansçš„è¿™äº›å±€é™æ€§ï¼Œæˆ‘ä»¬éœ€è¦å­¦ä¹ å…¶ä»–èšç±»ç®—æ³•æ¥åº”å¯¹æ›´å¤æ‚çš„æ•°æ®å’Œåœºæ™¯ã€‚
""")

# ä¿®æ”¹K-Meanså¤±æ•ˆæ¡ˆä¾‹çš„éƒ¨åˆ†ï¼Œæ·»åŠ è‡ªå·±ç”Ÿæˆçš„å›¾å’Œæ›´è¯¦ç»†çš„è§£é‡Š
st.subheader("K-Meanså¤±æ•ˆæ¡ˆä¾‹ç¤ºä¾‹")

# åˆ›å»ºæ¼”ç¤ºæ•°æ®
set_chinese_font()  # è®¾ç½®ä¸­æ–‡å­—ä½“

# ç”ŸæˆåŠæœˆå½¢æ•°æ®å’ŒK-Meansç»“æœ
fig, axs = plt.subplots(2, 2, figsize=(12, 10))
plt.subplots_adjust(hspace=0.4)

# åŠæœˆå½¢æ•°æ®
axs[0, 0].set_title('åŠæœˆå½¢æ•°æ® - çœŸå®åˆ†å¸ƒ')
X_moons, y_moons = make_moons(n_samples=200, noise=0.05, random_state=42)
axs[0, 0].scatter(X_moons[:, 0], X_moons[:, 1], c=y_moons, cmap='viridis', s=40)
axs[0, 0].set_xlabel('ç‰¹å¾1')
axs[0, 0].set_ylabel('ç‰¹å¾2')

# å¯¹åŠæœˆå½¢æ•°æ®ä½¿ç”¨K-Means
kmeans_moons = KMeans(n_clusters=2, random_state=42)
y_kmeans_moons = kmeans_moons.fit_predict(X_moons)
axs[0, 1].set_title('åŠæœˆå½¢æ•°æ® - K-Meansèšç±»ç»“æœ')
axs[0, 1].scatter(X_moons[:, 0], X_moons[:, 1], c=y_kmeans_moons, cmap='viridis', s=40)
centers_moons = kmeans_moons.cluster_centers_
axs[0, 1].scatter(centers_moons[:, 0], centers_moons[:, 1], c='red', marker='X', s=100)
axs[0, 1].set_xlabel('ç‰¹å¾1')
axs[0, 1].set_ylabel('ç‰¹å¾2')

# ç¯å½¢æ•°æ®
axs[1, 0].set_title('ç¯å½¢æ•°æ® - çœŸå®åˆ†å¸ƒ')
X_circles, y_circles = make_circles(n_samples=200, factor=0.5, noise=0.05, random_state=42)
axs[1, 0].scatter(X_circles[:, 0], X_circles[:, 1], c=y_circles, cmap='viridis', s=40)
axs[1, 0].set_xlabel('ç‰¹å¾1')
axs[1, 0].set_ylabel('ç‰¹å¾2')

# å¯¹ç¯å½¢æ•°æ®ä½¿ç”¨K-Means
kmeans_circles = KMeans(n_clusters=2, random_state=42)
y_kmeans_circles = kmeans_circles.fit_predict(X_circles)
axs[1, 1].set_title('ç¯å½¢æ•°æ® - K-Meansèšç±»ç»“æœ')
axs[1, 1].scatter(X_circles[:, 0], X_circles[:, 1], c=y_kmeans_circles, cmap='viridis', s=40)
centers_circles = kmeans_circles.cluster_centers_
axs[1, 1].scatter(centers_circles[:, 0], centers_circles[:, 1], c='red', marker='X', s=100)
axs[1, 1].set_xlabel('ç‰¹å¾1')
axs[1, 1].set_ylabel('ç‰¹å¾2')

st.pyplot(fig)

st.markdown("""
**ä¸ºä»€ä¹ˆK-Meansåœ¨è¿™äº›æ•°æ®ä¸Šå¤±æ•ˆï¼Ÿ**

ä¸Šå›¾å±•ç¤ºäº†K-Meansåœ¨éçƒå½¢æ•°æ®ä¸Šçš„æ˜æ˜¾å±€é™æ€§ï¼š

1. **åŠæœˆå½¢æ•°æ®**ï¼š
   - å·¦å›¾æ˜¾ç¤ºäº†ä¸¤ä¸ªåŠæœˆå½¢çš„çœŸå®ç°‡
   - å³å›¾æ˜¯K-Meansçš„èšç±»ç»“æœï¼Œå¯ä»¥çœ‹åˆ°å®ƒé”™è¯¯åœ°å°†æ•°æ®åˆ†å‰²æˆäº†ä¸Šä¸‹ä¸¤éƒ¨åˆ†
   - åŸå› ï¼šK-Meansåªèƒ½åŸºäºç‚¹åˆ°è´¨å¿ƒçš„æ¬§æ°è·ç¦»è¿›è¡Œåˆ’åˆ†ï¼Œæ— æ³•è¯†åˆ«å¼¯æ›²çš„ç»“æ„

2. **ç¯å½¢æ•°æ®**ï¼š
   - å·¦å›¾æ˜¾ç¤ºäº†å†…åœˆå’Œå¤–åœˆä¸¤ä¸ªç¯å½¢ç°‡
   - å³å›¾æ˜¯K-Meansçš„èšç±»ç»“æœï¼Œå®ƒå°†æ•°æ®é”™è¯¯åœ°åˆ†æˆäº†å·¦å³ä¸¤éƒ¨åˆ†
   - åŸå› ï¼šK-Meanså‡è®¾ç°‡æ˜¯å‡¸å½¢çš„ï¼Œæ— æ³•å¤„ç†ç¯å½¢æˆ–åµŒå¥—ç»“æ„

**ç»“è®º**ï¼šK-Meansåœ¨å¤„ç†éå‡¸æˆ–å¤æ‚å½¢çŠ¶ç°‡æ—¶æ•ˆæœä¸ä½³ã€‚å¯¹äºè¿™ç±»æ•°æ®ç»“æ„ï¼Œåº”è€ƒè™‘ä½¿ç”¨ï¼š
- DBSCANç®—æ³•ï¼ˆåŸºäºå¯†åº¦çš„èšç±»ï¼‰
- å±‚æ¬¡èšç±»ï¼ˆé…åˆå•è¿æ¥å¯è¯†åˆ«éå‡¸å½¢çŠ¶ï¼‰
- è°±èšç±»ï¼ˆå¤„ç†å¤æ‚æµå½¢ä¸Šçš„æ•°æ®ï¼‰
""")

# æ·»åŠ é¡µè„š
st.markdown("---")
st.markdown("Â© 2024 æœºå™¨å­¦ä¹ è¯¾ç¨‹ | äº¤äº’å¼èšç±»ç®—æ³•è¯¾ä»¶") 